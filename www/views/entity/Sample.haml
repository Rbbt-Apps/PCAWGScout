- require 'rbbt/tsv/excel'
- sample = entity
- entity_card = EntityCard.new(sample)
- entity_card.name = entity
- entity_card.meta do

  %h3 Sample tasks

  - task_exports = Sample.synchronous_exports + Sample.asynchronous_exports
  - task_exports = task_exports.collect{|t| t.to_s}
  %ul
    - task_exports.each do |task|
      - base_url = File.join("/", "Sample", task)
      - defaults = Sample.rec_input_defaults(task.to_sym) || {}
      - task_url = base_url +  "?" << Misc.hash2GET_params(defaults.merge(:jobname => entity))
      %li
        %a(href=task_url)= task
        - if defaults.any?
          - task_url = base_url +  "?" << Misc.hash2GET_params(:jobname => entity)
          %a(href=task_url) 
            %i.ui.settings.icon

- entity_card.description do

  - if sample.num_genomic_mutations > 0
    %dl
      %dt Genomic Mutations
      %dd= sample.num_genomic_mutations

      %dt Mutated (principal) Isoforms
      - isoforms = sample.mi(:principal => true) #.collect{|mi| mi.to_s}
      %dd= MutatedIsoform.setup(isoforms, sample.organism).list_link :length, "Mutated (principal) Isoforms in #{ sample }"

      %dt Affected genes
      %dd= sample.get_genes(:affected).list_link :length, "Affected genes in #{ sample }"

      %dt Damaged genes
      %dd= sample.get_genes(:damaged).list_link :length, "Damaged genes in #{ sample }"

    = table :table_id => "Sample gene status#{ sample }" do
      - sample.gene_sample_mutation_status

- entity_card.action_controller = default_action_controller sample

= entity_card_render entity_card
